---
layout: post
title: "주택매매가격 종합지수"
author: "Jonghyun Ho"
categories: Data Analysis
tags: [Crawling, Python, Pandas, DataFrame, 부동산, 아파트, 매매가격지수]
image: posts/20200501/housing-price-indices.png
---

부동산에서 아파트의 가격이 얼마나 오르고 내렸는지를 확인하기 위해 `주택매매가격 종합지수`를 참고할 필요가 있다.

`KB 부동산`과 `통계청` 에서 이 지수를 관리하고 있는데, 우선 `KB 부동산` 데이터를 이용하여 부동산 가격의 등락을 확인해보고자 한다.


## KB 부동산에서 주택매매가격 지수 확인

[KB 부동산](https://onland.kbstar.com/) 에 접속하면 `뉴스/자료실`에 `월간 KB주택가격동향` 메뉴를 확인할 수 있다.

해당 페이지의 `★시계열 자료 2020년 4월 기준 (1986년 1월 부터)` 라는 게시글에 시계열 데이터가 담긴 엑셀 파일을 확인할 수 있는데, 이를 다운로드 받는다.

![kb_onland_liivon](/assets/img/posts/20200501/kb_onland_liivon.png)

참고로 `주간 KB주택시장동향` 메뉴의 시계열 자료를 확인하면, 다음과 같이 지역별 주간 등락률을 시각적으로 확인할 수 있다.

![kb_onland_liivon](/assets/img/posts/20200501/changing_rate_of_apt_purchase_price.png)


## Python 을 이용한 분석

필요한 모듈을 임포트 한다.

``` python
import datetime
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib import font_manager, rc
```

`matplotlib` 라이브러리를 이용하여 그래프를 그릴 때, 한글 사용이 가능하도록 한다.

``` python
font_name = font_manager.FontProperties(fname="c:/Windows/Fonts/malgun.ttf").get_name()
rc('font', family=font_name)
```

다음 코드는 다운로드 받은 엑셀 파일과, 내부 엑셀시트 이름을 전달하면 `pandas DataFrame` 을 반환하는 함수이다.

`DataFrame` 을 반환하기 전에 각 column, row 에 대해 전처리 과정을 거친다.

``` python
def get_house_price_index(path, sheet):
    data = pd.read_excel(path, sheet_name=sheet, skiprows=1)
    data = data.set_index('구분')
    data = data.drop('Classification')

	# reorganize columns
    bignames = '서울 대구 부산 대전 광주 인천 울산 세종 경기 강원 충북 충남 전북 전남 경북 경남 제주도 6개광역시 5개광역시 수도권 기타지방 구분 전국'
    bignames = bignames.split(' ')
    big_col = list(data.columns)
    small_col = list(data.iloc[0])

    for num, small in enumerate(small_col):
        if str(small) == 'nan':
            small_col[num] = big_col[num]

        check = num
        while True:
            if big_col[check] in bignames:
                big_col[num] = big_col[check]
                break
            else:
                check -= 1

    data.columns = [big_col, small_col]

	# reorganize indices
    data = data[data.index.notnull()]
    data.index.name = 'date'

    new_index = []
    for num, raw_index in enumerate(data.index):
        raw_index = str(raw_index)
        if raw_index.find('.') >= 0:
            temp = raw_index.split('.')
            if len(temp[0]) == 2:
                new_index.append('19' + temp[0] + '.' + temp[1])
            else:
                new_index.append(raw_index)
        else:
            new_index.append(new_index[num-1].split('.')[0] + '.' + raw_index)

    data.set_index(pd.to_datetime(new_index), inplace=True)
    return data
```

위에서 구현한 `get_house_price_index` 함수를 호출하여, `주택매매가격 종합지수`의 모든 데이터를 출력한 결과이다.

``` python
data = get_house_price_index('datasets/★(월간)KB주택가격동향_시계열(2020.04).xlsx', '매매종합')
print(data)

                 전국       서울                    ...   경남  제주도              기타지방
                 전국       서울       강북      강북구  ...   통영  제주도 제주/\n서귀포     기타지방
1986-01-01  34.6561  30.0438    41.94      NaN  ...  NaN  NaN      NaN      NaN
1986-02-01  34.6561  30.0438  41.8891      NaN  ...  NaN  NaN      NaN      NaN
1986-03-01   34.708  30.0024  41.8891      NaN  ...  NaN  NaN      NaN      NaN
1986-04-01  34.4486  29.8366  41.7366      NaN  ...  NaN  NaN      NaN      NaN
1986-05-01  34.2929   29.588  41.2791      NaN  ...  NaN  NaN      NaN      NaN
...             ...      ...      ...      ...  ...  ...  ...      ...      ...
2019-12-01  100.222   102.56  102.275  103.256  ...  NaN  NaN  97.1319  97.5571
2020-01-01  100.576  103.056  102.687  103.382  ...  NaN  NaN  97.0367  97.5658
2020-02-01  100.948  103.417  103.006  103.488  ...  NaN  NaN  96.9613  97.5925
2020-03-01  101.511  103.905  103.403  103.332  ...  NaN  NaN  96.8012  97.6337
2020-04-01  101.744  104.072  103.577  103.194  ...  NaN  NaN  96.7289  97.6126

[412 rows x 186 columns]
```

## 지역별로 주택 가격은 어느 정도의 등락 차이가 있을까?

위에서 생성한 데이터에서 강남, 강북, 수도권 지역만을 필터링하여 하나의 `DataFrame`으로 분리하였다.

``` python
df = pd.DataFrame()
df['강남'] = data['서울']['강남']
df['강북'] = data['서울']['강북']
df['수도권'] = data['수도권']['수도권']
```

2000년 1월 1일 이후의 등락률을 표본 데이터로 삼았다.

[pct_change 함수](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pct_change.html) 는 현재와 이전 데이터와의 percent 차이를 계산해주고, [cumsum 함수](https://docs.scipy.org/doc/numpy/reference/generated/numpy.cumsum.html) 는 이들 간의 누적합을 계산해준다. 등락률의 누적합을 계산하여 각 지역별 차이를 확인하기 위한 목적이다.

``` python
df = df[df.index > datetime.datetime(2000, 1, 1)]
df = df.pct_change().cumsum()
```

그래프로 확인한 결과는 다음과 같다.

``` python
df.plot()
plt.grid()
plt.tight_layout()
plt.show()
```

![housing-price-indices](/assets/img/posts/20200501/housing-price-indices.png)

확인 결과, 서울 강남 > 수도권 > 서울 강북 순으로 상승폭이 컸음을 알 수 있다.

수도권의 상승이 서울의 강북보다 큰 것인가? 이러한 의문이 들어, 3개 도시 뿐 아니라 모든 도시의 등락률도 확인해 보고자 한다.

2000년 1월 1일 이후의 등락률의 누적합을 구하고, 마지막 날짜의 데이터만 취합하여 정리된 데이터를 내림차순으로 정렬하였다.

아래의 데이터를 확인해보면 서울 강남에 이어 경기도 광명, 안양, 성남 등의 수도권 도시들의 상승이 컸음을 알 수 있다.

```
data = data[data.index > datetime.datetime(2000, 1, 1)]
data = data.pct_change().cumsum()
data = data[data.index == datetime.datetime(2020, 4, 1)]
data = data.T
data = data.dropna()
data = data['2020-04-01'].sort_values(ascending=False)
for index in data.index:
    print(index, '{:.2f}'.format(data[index]))
	
('서울', '강남') 1.12
('경기', '광명') 1.11
('경기', '안양') 1.04
('경기', '성남') 1.01
('서울', '서울') 0.97
('경기', '안산') 0.94
('경기', '군포') 0.93
('경기', '부천') 0.89
('경기', '수원') 0.88
('수도권', '수도권') 0.87
('서울', '강북') 0.79
('전국', '전국') 0.73
('대전', '대전') 0.72
('경기', '분당구') 0.72
('인천', '인천') 0.71
('서울', '용산구') 0.71
('서울', '영등포구') 0.69
('대구', '대구') 0.68
('경기', '고양') 0.68
('6개광역시', '6개광역시') 0.68
('서울', '양천구') 0.68
('서울', '강남구') 0.66
('경기', '동안구') 0.66
('울산', '울산') 0.66
('광주', '광산구') 0.65
('서울', '노원구') 0.65
('서울', '송파구') 0.63
('경기', '과천') 0.63
('서울', '서초구') 0.63
('부산', '부산') 0.60
('광주', '서구') 0.60
('서울', '동작구') 0.60
('충북', '청주') 0.58
('대구', '수성구') 0.58
('충남', '천안') 0.58
('경기', '만안구') 0.57
('대구', '달서구') 0.57
('경기', '구리') 0.57
('서울', '성북구') 0.56
('경기', '영통구') 0.56
('서울', '구로구') 0.55
('울산', '남구') 0.55
('광주', '광주') 0.54
('서울', '성동구') 0.53
('서울', '강동구') 0.53
('서울', '마포구') 0.52
('대구', '북구') 0.52
('서울', '은평구') 0.52
('서울', '중구') 0.51
('울산', '북구') 0.50
('서울', '서대문구') 0.50
('부산', '해운대구') 0.49
('서울', '동대문구') 0.49
('부산', '사상구') 0.49
('대구', '동구') 0.48
('서울', '광진구') 0.48
('경기', '단원구') 0.47
('대구', '달성군') 0.47
('대전', '서구') 0.47
('울산', '중구') 0.47
('광주', '북구') 0.46
('울산', '울주군') 0.46
('경기', '팔달구') 0.45
('충북', '흥덕구') 0.45
('울산', '5개광역시\n(인천外)') 0.45
('광주', '남구') 0.45
('서울', '강북구') 0.45
('부산', '동래구') 0.44
('서울', '도봉구') 0.44
('경기', '중원구') 0.44
('서울', '금천구') 0.44
('경기', '시흥') 0.43
('서울', '강서구') 0.43
('서울', '종로구') 0.43
('대전', '중구') 0.43
('서울', '중랑구') 0.43
('서울', '관악구') 0.42
('인천', '서구') 0.42
('경기', '경기') 0.42
('부산', '북구') 0.41
('강원', '춘천') 0.41
('경기', '권선구') 0.41
('인천', '계양구') 0.40
('전북', '전주') 0.40
('전북', '완산구') 0.40
('강원', '원주') 0.40
('경기', '장안구') 0.40
('경기', '상록구') 0.39
('부산', '남구') 0.39
('경기', '덕양구') 0.39
('충북', '충주') 0.39
('전북', '덕진구') 0.38
('부산', '사하구') 0.38
('경기', '일산서구') 0.37
('대전', '대덕구') 0.37
('부산', '수영구') 0.37
('충북', '상당구') 0.37
('부산', '부산진구') 0.37
('전북', '전북') 0.36
('충북', '충북') 0.36
('경기', '일산동구') 0.35
('대전', '유성구') 0.35
('경기', '남양주') 0.34
('경북', '경산') 0.34
('대전', '동구') 0.34
('경기', '수정구') 0.34
('경기', '이천') 0.33
('경기', '용인') 0.33
('경남', '김해') 0.32
('전북', '익산') 0.32
('경남', '창원') 0.32
('울산', '동구') 0.32
('경남', '경남') 0.31
('인천', '미추홀구') 0.31
('대구', '중구') 0.31
('인천', '부평구') 0.31
('강원', '강원') 0.31
('부산', '기장군') 0.30
('인천', '연수구') 0.30
('전북', '군산') 0.29
('기타지방', '기타지방') 0.29
('경기', '의정부') 0.28
('광주', '동구') 0.27
('경남', '진해구') 0.26
('부산', '연제구') 0.26
('대구', '서구') 0.25
('인천', '동구') 0.25
('부산', '금정구') 0.24
('충남', '아산') 0.24
('경기', '수지구') 0.24
('경북', '경북') 0.23
('전남', '여수') 0.23
('인천', '남동구') 0.22
('경기', '김포') 0.21
('경기', '기흥구') 0.21
('전남', '전남') 0.20
('경기', '처인구') 0.20
('경북', '북구') 0.20
('경북', '구미') 0.20
('대구', '남구') 0.18
('충남', '충남') 0.17
('경북', '포항') 0.17
('충남', '서북구') 0.17
('경남', '진주') 0.17
('부산', '영도구') 0.16
('부산', '서구') 0.15
('충남', '동남구') 0.15
('경북', '남구') 0.15
('경기', '평택') 0.15
('제주도', '제주/\n서귀포') 0.14
('부산', '중구') 0.12
('인천', '중구') 0.11
('경남', '마산합포구') 0.11
('충남', '논산') 0.11
('전남', '목포') 0.11
('세종', '세종') 0.10
('경기', '파주') 0.10
('경남', '마산회원구') 0.06
('경기', '화성') 0.05
('부산', '동구') 0.02
('전남', '순천') 0.00
('경남', '의창구') -0.01
('충남', '공주') -0.07
('충북', '청원구') -0.08
('충북', '서원구') -0.11
('경남', '성산구') -0.14
```